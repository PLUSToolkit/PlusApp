<PlusConfiguration version="2.1">
  <DataCollection StartupDelaySec="1.0" >
    <DeviceSet 
      Name="PlusServer: HoloLens - Replay fCal 3d data with live NDI Aurora tracking"
      Description="Replay of saved imaging data with live tracking data for help with developing the HoloLens project." />
    <Device
      Id="VideoDevice"
      Type="SavedDataSource"
      SequenceFile="ie33_NDIAurora_Probe_Stylus_compressed.mha"
      UseData="IMAGE"
      RepeatEnabled="TRUE" >
      <DataSources>
        <DataSource Type="Video" Id="Video" />
      </DataSources>
      <OutputChannels>
        <OutputChannel Id="VideoStream" VideoDataSourceId="Video" />
      </OutputChannels>
    </Device>

    <Device
      Id="TrackerDevice" 
      Type="AuroraTracker"
      SerialPort="3"
      ToolReferenceFrame="Tracker" >
      <DataSources>
        <DataSource Type="Tool" Id="Phantom" PortName="0" />
      </DataSources>
      <OutputChannels>
        <OutputChannel Id="TrackerStream">
          <DataSource Id="Phantom" />
        </OutputChannel>
      </OutputChannels>
    </Device>
    
    <Device 
      Id="TrackedVideoDevice" 
      Type="VirtualMixer" >
      <InputChannels>
        <InputChannel Id="TrackerStream" />
        <InputChannel Id="VideoStream" />
      </InputChannels>
      <OutputChannels>
        <OutputChannel Id="TrackedVideoStream"/>
      </OutputChannels>
    </Device>
  </DataCollection>

  <PlusOpenIGTLinkServer 
    MaxNumberOfIgtlMessagesToSend="1" 
    MaxTimeSpentWithProcessingMs="50" 
    DefaultClientSendTimeoutSec="0"
    ListeningPort="18944" 
    SendValidTransformsOnly="true" 
    OutputChannelId="TrackedVideoStream" > 
    <DefaultClientInfo> 
      <MessageTypes> 
        <Message Type="TRACKEDFRAME" />
      </MessageTypes>
      <TransformNames>
        <Transform Name="ImageToReference"/>
        <Transform Name="StylusToReference"/>
        <Transform Name="ProbeToReference"/>
        <Transform Name="PhantomToReference"/>
        <Transform Name="RedSphere1ToPhantom"/>
        <Transform Name="RedSphere2ToPhantom"/>
        <Transform Name="RedSphere3ToPhantom"/>
        <Transform Name="RedSphere4ToPhantom"/>
        <Transform Name="RedSphere5ToPhantom"/>
      </TransformNames>
      <ImageNames>
        <Image Name="Image" EmbeddedTransformToFrame="Reference" />
      </ImageNames>
    </DefaultClientInfo>
  </PlusOpenIGTLinkServer>

  <CoordinateDefinitions>
    <Transform From="Image" To="Probe"
      Matrix="
        1     0    0     0
        0     1    0     0
        0     0    1     0
        0     0    0     1"
      Error="0.0" Date="012712_152030" />
    <Transform From="Probe" To="Phantom"
      Matrix="
        1     0    0     0
        0     1    0     0
        0     0    1     0
        0     0    0     1"
      Error="0.0" Date="012712_152030" />
    <Transform From="Stylus" To="Phantom"
      Matrix="
        1     0    0     0
        0     1    0     0
        0     0    1     0
        0     0    0     1"
      Error="0.0" Date="012712_152030" />
    <Transform From="Reference" To="Phantom"
      Matrix="
        1     0    0     0
        0     1    0     0
        0     0    1     0
        0     0    0     1"
      Error="0.0" Date="012712_152030" />
    <!-- 1 = green, 2 = hub, 3 = yellow, 4 = blue, 5 = teal -->
    <Transform From="RedSphere1" To="Phantom"
      Matrix="
        0.908182	0	0.418576	38.4158
        0.41852	-0.0164886	-0.908058	-83.3391
        0.00690175	0.999864	-0.0149747	-1.37433
        0	0	0	1"
       Error="0.460909" Date="012217_162405" />

    <Transform From="RedSphere2" To="Phantom"
      Matrix="
        0.762407	0	-0.647098	-23.35
        0.641294	-0.133636	0.755568	27.2641
        -0.0864758	-0.99103	-0.101885	-3.67645
        0	0	0	1"
       Error="1.20231" Date="012217_162912" />

    <Transform From="RedSphere3" To="Phantom"
      Matrix="
        0.442096	0	-0.896968	-99.5291
        0.538623	-0.79963	0.265476	29.4576
        -0.717242	-0.600493	-0.353513	-39.2264
        0	0	0	1"
       Error="1.42647" Date="012217_162707" />

    <Transform From="RedSphere4" To="Phantom"
      Matrix="
        0.971239	0	-0.238109	-24.6704
        0.186731	0.620474	0.761672	78.9166
        0.14774	-0.784227	0.602628	62.4381
        0	0	0	1"
       Error="0.703026" Date="012217_162551" />
       
    <Transform From="RedSphere5" To="Phantom"
      Matrix="
        0.971843	0	-0.235628	-26.6609
        0.212161	-0.43505	0.875054	99.0105
        -0.10251	-0.900406	-0.4228	-47.839
        0	0	0	1"
       Error="0.823018" Date="012217_162743" />
  </CoordinateDefinitions> 
</PlusConfiguration>
